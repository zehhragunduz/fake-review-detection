# -*- coding: utf-8 -*-
"""bilstm_review_classification.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1CLAv9c3aJ5QNOEVxIztcMhjb0YsxYIsc
"""

import pandas as pd
from sklearn.model_selection import train_test_split
from tensorflow.keras.preprocessing.text import Tokenizer
from tensorflow.keras.preprocessing.sequence import pad_sequences
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Embedding, Bidirectional, LSTM, Dense
from sklearn.metrics import classification_report, confusion_matrix, ConfusionMatrixDisplay
import matplotlib.pyplot as plt

# 1. VERÄ°YÄ° YÃœKLE
df = pd.read_csv("/content/sonveriseti.csv")

# 2. GEREKLÄ° SÃœTUNLARI AL
df = df[['translated_text', 'label']].copy()
df.rename(columns={'translated_text': 'review'}, inplace=True)

# 3. NaN temizliÄŸi
df.dropna(inplace=True)
df['label'] = df['label'].astype(int)

# 4. EÄÄ°TÄ°M / TEST AYIR
X = df['review'].values
y = df['label'].values
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# 5. TOKENIZER ve PADDING
vocab_size = 10000
max_len = 100

tokenizer = Tokenizer(num_words=vocab_size, oov_token="<OOV>")
tokenizer.fit_on_texts(X_train)

X_train_seq = tokenizer.texts_to_sequences(X_train)
X_test_seq = tokenizer.texts_to_sequences(X_test)

X_train_pad = pad_sequences(X_train_seq, maxlen=max_len, padding='post')
X_test_pad = pad_sequences(X_test_seq, maxlen=max_len, padding='post')

# 6. BiLSTM MODELÄ°
model = Sequential([
    Embedding(input_dim=vocab_size, output_dim=64, input_length=max_len),
    Bidirectional(LSTM(64)),
    Dense(32, activation='relu'),
    Dense(1, activation='sigmoid')
])

model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])

# 7. MODELÄ° EÄÄ°T
history = model.fit(X_train_pad, y_train, epochs=5, batch_size=32, validation_data=(X_test_pad, y_test))

# 8. TAHMÄ°N VE METRÄ°KLER
y_pred = (model.predict(X_test_pad) > 0.5).astype("int32")

print(classification_report(y_test, y_pred))

# 9. CONFUSION MATRIX
cm = confusion_matrix(y_test, y_pred)
disp = ConfusionMatrixDisplay(confusion_matrix=cm, display_labels=["SAHTE", "GERÃ‡EK"])
disp.plot(cmap=plt.cm.Blues)
plt.title("BiLSTM Confusion Matrix")
plt.show()

from tensorflow.keras.preprocessing.sequence import pad_sequences

def yorum_tahmin_et(yorum):
    # Yorumu sayÄ±ya Ã§evir
    seq = tokenizer.texts_to_sequences([yorum])

    # Sabit uzunluÄŸa pad et
    pad_seq = pad_sequences(seq, maxlen=max_len, padding='post')

    # Tahmin yap
    tahmin = model.predict(pad_seq)[0][0]

    # Ekrana yazdÄ±r
    if tahmin >= 0.5:
        print(f"âœ… GERÃ‡EK yorum ({tahmin:.2f})")
    else:
        print(f"âŒ SAHTE yorum ({tahmin:.2f})")

yorumlar = [
    # SAHTE yorumlar
    "ÃœrÃ¼n mÃ¼kemmel, harika, ÅŸahane, mutlaka alÄ±n!",  # aÅŸÄ±rÄ± olumlu dolgu
    "Kesinlikle tavsiye ederim, herkes alsÄ±n bence.",  # yapay tavsiye
    "Harika! Harika! Harika!",  # tekrar ve abartÄ±
    "HenÃ¼z kullanmadÄ±m ama iyi gibi duruyor.",  # deneyimsiz
    "Bu Ã¼rÃ¼nÃ¼ ikinci kez alÄ±yorum Ã§Ã¼nkÃ¼ Ã§ok gÃ¼zel. (ilk kez almÄ±ÅŸ)",  # tutarsÄ±z
    "SatÄ±cÄ± Ã§ok ilgiliydi ama Ã¼rÃ¼nÃ¼ daha aÃ§madÄ±m.",  # iÃ§erik yok
    "ÃœrÃ¼n gÃ¼zel, kaliteli, saÄŸlam, hoÅŸ. (detay yok)",  # kalÄ±p cÃ¼mle
    "ÃœrÃ¼n Ã§ok iyi Ã§alÄ±ÅŸÄ±yor (yorum 5 farklÄ± Ã¼rÃ¼nde aynÄ±)",  # kopya yorum
    "1 dakikadÄ±r kullanÄ±yorum, Ã§ok kaliteli bir Ã¼rÃ¼n.",  # kÄ±sa deneyim
    "GerÃ§ekten harika. Sadece harika.",  # iÃ§eriksiz ve boÅŸ

    # GERÃ‡EK yorumlar
    "Kargo zamanÄ±nda geldi ancak kutu biraz ezilmiÅŸti.",
    "2 haftadÄ±r kullanÄ±yorum, pil performansÄ± beklentimi aÅŸtÄ±.",
    "ÃœrÃ¼nÃ¼n aÃ§Ä±klamasÄ±nda yazan renk farklÄ± geldi ama iade ettim.",
    "Kablo uzunluÄŸu yeterli deÄŸil ama ses kalitesi iyi.",
    "Ekran camÄ±nda Ã§izik vardÄ±, garantiye gÃ¶nderdim.",
    "KullanÄ±mÄ± kolay ama ÅŸarj sÃ¼resi biraz kÄ±sa.",
    "Paketlemesi gÃ¼zeldi ve hÄ±zlÄ± teslimat yapÄ±ldÄ±.",
    "Kutusundan kulaklÄ±k Ã§Ä±kmadÄ±, firmayla iletiÅŸime geÃ§tim.",
    "Malzeme kalitesi fiyatÄ±na gÃ¶re iyi, memnun kaldÄ±m.",
    "Uzun sÃ¼reli kullanÄ±mda biraz Ä±sÄ±nÄ±yor ama genel olarak iyi."
]

for yorum in yorumlar:
    print("ğŸ“ Yorum:", yorum)
    yorum_tahmin_et(yorum)  # Daha Ã¶nce verdiÄŸimiz tahmin fonksiyonu
    print("-" * 60)